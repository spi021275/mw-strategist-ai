<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multimedia & Workspaces Strategist AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
    <style>
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
        }
        .loading { animation: spin 2s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">
                    Multimedia & Workspaces Strategist AI
                </h1>
                <p class="text-gray-600 mt-1 text-sm sm:text-base">
                    Il tuo partner strategico per spazi di collaborazione perfetti
                </p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="app" class="max-w-7xl mx-auto px-4 py-12">
        <!-- Intro Section -->
        <div id="introSection" class="bg-white rounded-xl shadow-lg p-8">
            <div class="flex items-start mb-6">
                <svg class="w-12 h-12 text-blue-600 mt-1 mr-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
                <div class="w-full">
                    <h2 class="text-3xl font-bold text-gray-900 mb-4">Scegli il tuo modulo</h2>
                    <p class="text-lg text-gray-700 mb-8">Seleziona lo strumento che ti serve per il tuo progetto</p>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- Module 1 -->
                        <div class="border border-gray-200 rounded-lg p-6 hover:shadow-md hover:border-blue-300 transition-all">
                            <svg class="w-10 h-10 text-blue-600 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                            </svg>
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Wizard in Sviluppo</h3>
                    <p class="text-gray-600 max-w-2xl mx-auto">
                        Il wizard per spazi collaborativi √® in fase di sviluppo avanzato. 
                        Sar√† disponibile a breve con funzionalit√† complete.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="mt-16 pb-8 text-center text-sm text-gray-500">
        <p>
            Strumento personalizzato per la BU Multimedia & Workspaces di
            <span class="font-semibold text-blue-600">Var Group</span>
        </p>
        <p class="mt-2 text-xs text-gray-400 max-w-2xl mx-auto px-4">
            Sviluppato utilizzando l'expertise della BU e il framework AI del B2B Sales Strategist AI
        </p>
    </div>

    <script>
        console.log("üéØ Multimedia & Workspaces AI - Versione Demo");
        
        // State management
        let uploadedFiles = [];
        let transcriptContent = '';
        let generatedBriefContent = '';

        // Navigation functions
        function showIntro() {
            document.getElementById('introSection').classList.remove('hidden');
            document.getElementById('postMeetingSection').classList.add('hidden');
            document.getElementById('spaceWizardSection').classList.add('hidden');
        }

        function showPostMeeting() {
            document.getElementById('introSection').classList.add('hidden');
            document.getElementById('postMeetingSection').classList.remove('hidden');
            document.getElementById('spaceWizardSection').classList.add('hidden');
        }

        function showSpaceWizard() {
            document.getElementById('introSection').classList.add('hidden');
            document.getElementById('postMeetingSection').classList.add('hidden');
            document.getElementById('spaceWizardSection').classList.remove('hidden');
        }

        // File upload handling for planimetrie/documenti
        document.getElementById('fileUpload').addEventListener('change', function(event) {
            const files = Array.from(event.target.files);
            
            files.forEach(file => {
                const fileObj = {
                    name: file.name,
                    size: (file.size / 1024 / 1024).toFixed(2) + ' MB',
                    type: file.type || 'application/octet-stream'
                };
                uploadedFiles.push(fileObj);
            });

            updateFileDisplay();
        });

        // Enhanced transcript upload handling with better DOCX support
        document.getElementById('transcriptUpload').addEventListener('change', async function(event) {
            const file = event.target.files[0];
            if (!file) return;

            try {
                let content = '';
                
                // Handle different file types
                if (file.name.toLowerCase().endsWith('.docx')) {
                    // Use mammoth.js for DOCX files
                    const arrayBuffer = await file.arrayBuffer();
                    const result = await mammoth.extractRawText({ arrayBuffer: arrayBuffer });
                    content = result.value;
                } else if (file.name.toLowerCase().endsWith('.pdf')) {
                    // For PDF files, read as text (basic extraction)
                    content = await readFileAsText(file);
                    content = "File PDF caricato: " + file.name + "\n\nNOTA: Per i file PDF √® consigliabile copiare manualmente il testo nelle note del meeting per una migliore analisi.";
                } else {
                    // For TXT and other text files
                    content = await readFileAsText(file);
                }

                // Clean up transcript content for Teams format
                content = cleanTeamsTranscript(content);
                transcriptContent = content;
                
                // Show file info
                document.getElementById('transcriptFileName').textContent = file.name;
                document.getElementById('transcriptFile').classList.remove('hidden');
                
                // Show preview
                const preview = content.substring(0, 500) + (content.length > 500 ? '...' : '');
                document.getElementById('transcriptPreviewContent').textContent = preview;
                document.getElementById('transcriptPreview').classList.remove('hidden');
                
                // Add content to meeting notes
                const meetingNotesTextarea = document.getElementById('meetingNotes');
                const currentNotes = meetingNotesTextarea.value;
                const separator = currentNotes ? '\n\n--- TRASCRIZIONE MEETING ---\n' : '--- TRASCRIZIONE MEETING ---\n';
                meetingNotesTextarea.value = currentNotes + separator + content;
                
            } catch (error) {
                console.error('Errore nel caricamento del file:', error);
                alert('Errore nel caricamento del file: ' + error.message);
            }
        });

        // Clean Teams transcript function
        function cleanTeamsTranscript(rawContent) {
            if (!rawContent) return '';
            
            let cleaned = rawContent;
            
            // Remove image references and metadata
            cleaned = cleaned.replace(/!\[.*?\]\(.*?\)/g, '');
            cleaned = cleaned.replace(/\{width=".*?"\s*height=".*?"\}/g, '');
            cleaned = cleaned.replace(/media\/[a-zA-Z0-9_-]+\.png/g, '');
            
            // Remove timestamp headers
            cleaned = cleaned.replace(/\*\*Trascrizione\*\*\s*\d+.*?\d+:\d+[AP]M/g, '');
            
            // Clean up speaker names and format
            cleaned = cleaned.replace(/\*\*\\\s*/g, '');
            cleaned = cleaned.replace(/\*\*\s*([^*]+)\*\*\s*(\d+:\d+)\\\s*/g, '\n$1 ($2): ');
            cleaned = cleaned.replace(/\*\*\s*([^*]+)\*\*\s*/g, '\n$1: ');
            
            // Remove extra asterisks and formatting
            cleaned = cleaned.replace(/\*+/g, '');
            cleaned = cleaned.replace(/\\\s*/g, ' ');
            
            // Clean up multiple newlines and spaces
            cleaned = cleaned.replace(/\n\s*\n\s*\n/g, '\n\n');
            cleaned = cleaned.replace(/[ \t]+/g, ' ');
            
            // Remove "trascrizione avviata/arrestata" lines
            cleaned = cleaned.replace(/.*trascrizione (avviata|arrestata).*/gi, '');
            
            return cleaned.trim();
        }

        // Read file as text
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    resolve(e.target.result);
                };
                
                reader.onerror = function() {
                    reject(new Error('Errore nella lettura del file'));
                };
                
                reader.readAsText(file, 'UTF-8');
            });
        }

        // Remove transcript
        function removeTranscript() {
            transcriptContent = '';
            document.getElementById('transcriptFile').classList.add('hidden');
            document.getElementById('transcriptPreview').classList.add('hidden');
            document.getElementById('transcriptUpload').value = '';
            
            // Remove from meeting notes
            const meetingNotesTextarea = document.getElementById('meetingNotes');
            const content = meetingNotesTextarea.value;
            const cleanedContent = content.replace(/\n*--- TRASCRIZIONE MEETING ---\n[\s\S]*$/, '');
            meetingNotesTextarea.value = cleanedContent;
        }

        function updateFileDisplay() {
            const uploadedFilesDiv = document.getElementById('uploadedFiles');
            const fileList = document.getElementById('fileList');
            
            if (uploadedFiles.length > 0) {
                uploadedFilesDiv.classList.remove('hidden');
                fileList.innerHTML = uploadedFiles.map((file, index) => `
                    <div class="flex items-center justify-between bg-gray-100 p-3 rounded-lg">
                        <div>
                            <span class="font-medium">${file.name}</span>
                            <span class="text-sm text-gray-500 ml-2">(${file.size})</span>
                        </div>
                        <button onclick="removeFile(${index})" class="text-red-500 hover:text-red-700">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                `).join('');
            } else {
                uploadedFilesDiv.classList.add('hidden');
            }
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateFileDisplay();
        }

        // Form validation
        function canGenerateBrief() {
            const clientName = document.getElementById('clientName').value.trim();
            const meetingNotes = document.getElementById('meetingNotes').value.trim();
            const numberOfRooms = document.getElementById('numberOfRooms').value.trim();
            
            return clientName && meetingNotes && numberOfRooms;
        }

        // Get selected values from checkboxes
        function getSelectedValues(containerId) {
            const container = document.getElementById(containerId);
            const checkboxes = container.querySelectorAll('input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // Generate demo brief - NO API CALLS
        async function generateBrief() {
            console.log("üéØ Generazione brief demo...");
            
            if (!canGenerateBrief()) {
                alert('Per favore compila almeno: Nome Cliente, Numero Sale/Spazi e Note del Meeting');
                return;
            }

            const generateBtn = document.getElementById('generateBtn');
            const originalText = generateBtn.innerHTML;
            
            // Show loading state
            generateBtn.innerHTML = `
                <svg class="w-5 h-5 mr-3 loading" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Generazione in corso...
            `;
            generateBtn.disabled = true;

            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 2000));

            try {
                // Collect form data
                const formData = {
                    clientName: document.getElementById('clientName').value,
                    contactPerson: document.getElementById('contactPerson').value,
                    meetingDate: document.getElementById('meetingDate').value,
                    numberOfRooms: document.getElementById('numberOfRooms').value,
                    budget: document.getElementById('budget').value,
                    spaceTypes: getSelectedValues('spaceTypes'),
                    techRequirements: getSelectedValues('techRequirements'),
                    meetingNotes: document.getElementById('meetingNotes').value,
                    timeline: document.getElementById('timeline').value,
                    specialRequirements: document.getElementById('specialRequirements').value
                };

                console.log("üìã Dati raccolti:", formData);

                // Generate demo brief with real data
                const briefHTML = generateDemoBrief(formData);
                
                // Show generated brief
                generatedBriefContent = briefHTML;
                document.getElementById('briefContent').innerHTML = briefHTML;
                document.getElementById('postMeetingForm').classList.add('hidden');
                document.getElementById('generatedBrief').classList.remove('hidden');
                document.getElementById('generatedBrief').classList.add('fade-in');

                console.log("‚úÖ Brief demo generato con successo!");

            } catch (error) {
                console.error('‚ùå Errore:', error);
                alert('Errore nella generazione del brief: ' + error.message);
            } finally {
                // Restore button
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
            }
        }

        // Generate demo brief with real form data
        function generateDemoBrief(formData) {
            const currentDate = new Date().toLocaleDateString('it-IT');
            const hasTranscript = transcriptContent ? true : false;
            const fileList = uploadedFiles.map(f => f.name).join(', ');
            
            return `
<div class="space-y-6">
    <div class="border-b pb-4">
        <h1 class="text-2xl font-bold text-blue-800 mb-2">BRIEF TECNICO PER DSA</h1>
        <p class="text-gray-600">Cliente: <strong>${formData.clientName}</strong> | Data: ${currentDate}</p>
        ${formData.contactPerson ? `<p class="text-gray-600">Contatto: <strong>${formData.contactPerson}</strong></p>` : ''}
    </div>

    <div class="bg-blue-50 p-4 rounded-lg">
        <h2 class="text-xl font-semibold text-blue-800 mb-3">üìã EXECUTIVE SUMMARY</h2>
        <p><strong>${formData.clientName}</strong> richiede la progettazione e implementazione di <strong>${formData.numberOfRooms}</strong> per modernizzare i propri spazi collaborativi.</p>
        ${formData.budget ? `<p class="mt-2"><strong>Budget indicativo:</strong> ${formData.budget}</p>` : ''}
        ${formData.timeline ? `<p><strong>Timeline:</strong> ${formData.timeline}</p>` : ''}
        <p class="mt-2">L'obiettivo √® creare un ambiente di lavoro ibrido che favorisca la collaborazione e la produttivit√† del team.</p>
    </div>

    <div>
        <h2 class="text-xl font-semibold text-gray-800 mb-3">üîç ANALISI REQUISITI</h2>
        
        <div class="grid md:grid-cols-2 gap-4">
            <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold text-gray-800 mb-2">Requisiti Funzionali</h3>
                <ul class="space-y-1 text-sm">
                    <li>‚Ä¢ Configurazione spazi: ${formData.numberOfRooms}</li>
                    ${formData.spaceTypes.length > 0 ? `<li>‚Ä¢ Tipologie: ${formData.spaceTypes.join(', ')}</li>` : ''}
                    <li>‚Ä¢ Integrazione piattaforme collaboration</li>
                    <li>‚Ä¢ Facilit√† d'uso per utenti non tecnici</li>
                </ul>
            </div>
            
            <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold text-gray-800 mb-2">Requisiti Tecnici</h3>
                <ul class="space-y-1 text-sm">
                    ${formData.techRequirements.length > 0 ? 
                        formData.techRequirements.map(req => `<li>‚Ä¢ ${req}</li>`).join('') : 
                        '<li>‚Ä¢ Soluzioni AV integrate</li><li>‚Ä¢ Connettivit√† wireless stabile</li>'
                    }
                    <li>‚Ä¢ Qualit√† audio/video professionale</li>
                    <li>‚Ä¢ Gestione centralizzata</li>
                </ul>
            </div>
        </div>

        ${formData.specialRequirements ? `
        <div class="mt-4 bg-yellow-50 p-4 rounded-lg">
            <h3 class="font-semibold text-yellow-800 mb-2">Requisiti Speciali</h3>
            <p class="text-yellow-700">${formData.specialRequirements}</p>
        </div>
        ` : ''}
    </div>

    <div>
        <h2 class="text-xl font-semibold text-gray-800 mb-3">üè¢ SPECIFICHE SPAZI</h2>
        
        ${formData.spaceTypes.length > 0 ? 
            formData.spaceTypes.map(spaceType => `
            <div class="bg-gray-50 p-4 rounded-lg mb-3">
                <h3 class="font-semibold text-gray-800">${spaceType}</h3>
                <div class="mt-2 grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <strong>Partecipanti:</strong> ${getParticipantCount(spaceType)}
                    </div>
                    <div>
                        <strong>Tecnologie:</strong> ${getTechForSpace(spaceType, formData.techRequirements)}
                    </div>
                </div>
            </div>
            `).join('') :
            `
            <div class="bg-gray-50 p-4 rounded-lg">
                <p>Dettagli specifici da definire in base al sopralluogo e alle planimetrie fornite.</p>
                <p class="mt-2"><strong>Sale da configurare:</strong> ${formData.numberOfRooms}</p>
            </div>
            `
        }
    </div>

    <div>
        <h2 class="text-xl font-semibold text-gray-800 mb-3">‚öôÔ∏è INDICAZIONI TECNOLOGICHE</h2>
        
        <div class="grid md:grid-cols-2 gap-4">
            <div class="bg-green-50 p-4 rounded-lg">
                <h3 class="font-semibold text-green-800 mb-2">Soluzioni Raccomandate</h3>
                <ul class="space-y-1 text-sm text-green-700">
                    <li>‚Ä¢ Microsoft Teams Rooms native</li>
                    <li>‚Ä¢ Soluzioni BYOD integrate</li>
                    <li>‚Ä¢ Audio Dante per qualit√† professionale</li>
                    <li>‚Ä¢ Display 4K per videoconferenza</li>
                    <li>‚Ä¢ Controlli touch intuitivi</li>
                </ul>
            </div>
            
            <div class="bg-blue-50 p-4 rounded-lg">
                <h3 class="font-semibold text-blue-800 mb-2">Partner Tecnologici</h3>
                <ul class="space-y-1 text-sm text-blue-700">
                    <li>‚Ä¢ Microsoft (Teams, Surface Hub)</li>
                    <li>‚Ä¢ Logitech (Webcam, Audio)</li>
                    <li>‚Ä¢ Poly (Soluzioni conferencing)</li>
                    <li>‚Ä¢ Epson (Proiezione)</li>
                    <li>‚Ä¢ Crestron (Controllo)</li>
                </ul>
            </div>
        </div>
    </div>

    <div>
        <h2 class="text-xl font-semibold text-gray-800 mb-3">üì¶ DELIVERABLE RICHIESTI AL DSA</h2>
        
        <div class="bg-orange-50 p-4 rounded-lg">
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <h3 class="font-semibold text-orange-800 mb-2">Documentazione Tecnica</h3>
                    <ul class="space-y-1 text-sm text-orange-700">
                        <li>‚Ä¢ Tech Annex dettagliato per ogni spazio</li>
                        <li>‚Ä¢ Schemi di collegamento AV</li>
                        <li>‚Ä¢ Layout planimetrico con posizionamento</li>
                        <li>‚Ä¢ Specifiche tecniche complete</li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-semibold text-orange-800 mb-2">Economics & Timeline</h3>
                    <ul class="space-y-1 text-sm text-orange-700">
                        <li>‚Ä¢ Preventivo dettagliato per voce</li>
                        <li>‚Ä¢ Cronoprogramma implementazione</li>
                        <li>‚Ä¢ Piano di project management</li>
                        <li>‚Ä¢ Costi di manutenzione e supporto</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    ${fileList ? `
    <div>
        <h2 class="text-xl font-semibold text-gray-800 mb-3">üìÅ DOCUMENTAZIONE ALLEGATA</h2>
        <div class="bg-gray-50 p-4 rounded-lg">
            <p class="mb-2"><strong>File ricevuti:</strong></p>
            <ul class="text-sm text-gray-700">
                ${uploadedFiles.map(file => `<li>‚Ä¢ ${file.name} (${file.size})</li>`).join('')}
            </ul>
            <p class="mt-3 text-sm text-gray-600">
                <strong>Note per il DSA:</strong> Utilizzare la documentazione allegata per:
            </p>
            <ul class="mt-1 text-sm text-gray-600">
                <li>‚Ä¢ Analisi delle planimetrie per il posizionamento ottimale</li>
                <li>‚Ä¢ Verifica vincoli architettonici e impiantistici</li>
                <li>‚Ä¢ Calcolo preciso delle distanze e dimensionamenti</li>
            </ul>
        </div>
    </div>
    ` : ''}

    ${hasTranscript ? `
    <div>
        <h2 class="text-xl font-semibold text-gray-800 mb-3">üéôÔ∏è PUNTI SALIENTI MEETING</h2>
        <div class="bg-blue-50 p-4 rounded-lg">
            <p class="text-sm text-blue-700 mb-2">
                <strong>Nota:</strong> Trascrizione meeting processata e integrata nell'analisi dei requisiti.
            </p>
            <p class="text-sm text-blue-600">
                Riferimenti specifici del cliente e discussioni tecniche sono stati estratti 
                e incorporati nelle sezioni precedenti del brief.
            </p>
        </div>
    </div>
    ` : ''}

    <div>
        <h2 class="text-xl font-semibold text-gray-800 mb-3">üéØ NEXT STEPS</h2>
        
        <div class="space-y-3">
            <div class="bg-red-50 p-4 rounded-lg">
                <h3 class="font-semibold text-red-800 mb-2">üö® Azioni Immediate</h3>
                <ul class="space-y-1 text-sm text-red-700">
                    <li>‚Ä¢ Sopralluogo tecnico per verifica vincoli</li>
                    <li>‚Ä¢ Acquisizione planimetrie aggiornate (se non fornite)</li>
                    <li>‚Ä¢ Verifica infrastruttura di rete esistente</li>
                    <li>‚Ä¢ Definizione cronoprogramma dettagliato</li>
                </ul>
            </div>
            
            <div class="bg-yellow-50 p-4 rounded-lg">
                <h3 class="font-semibold text-yellow-800 mb-2">üìã Informazioni da Raccogliere</h3>
                <ul class="space-y-1 text-sm text-yellow-700">
                    <li>‚Ä¢ Specifiche tecniche infrastruttura IT</li>
                    <li>‚Ä¢ Policy aziendali su sicurezza e privacy</li>
                    <li>‚Ä¢ Preferenze su brand e fornitori</li>
                    <li>‚Ä¢ Requisiti di integrazione con sistemi esistenti</li>
                </ul>
            </div>
            
            <div class="bg-green-50 p-4 rounded-lg">
                <h3 class="font-semibold text-green-800 mb-2">üìÖ Milestone Progetto</h3>
                <ul class="space-y-1 text-sm text-green-700">
                    <li>‚Ä¢ Presentazione Tech Annex: +1 settimana</li>
                    <li>‚Ä¢ Approvazione budget: +2 settimane</li>
                    <li>‚Ä¢ Inizio implementazione: ${formData.timeline || '+1 mese'}</li>
                    <li>‚Ä¢ Go-live e training: +6 settimane</li>
                </ul>
            </div>
        </div>
    </div>

    ${formData.meetingNotes ? `
    <div>
        <h2 class="text-xl font-semibold text-gray-800 mb-3">üìù NOTE ORIGINALI MEETING</h2>
        <div class="bg-gray-100 p-4 rounded-lg">
            <pre class="text-sm text-gray-700 whitespace-pre-wrap">${formData.meetingNotes.substring(0, 1000)}${formData.meetingNotes.length > 1000 ? '...' : ''}</pre>
        </div>
    </div>
    ` : ''}
</div>
            `;
        }

        // Helper functions for demo brief
        function getParticipantCount(spaceType) {
            const counts = {
                'Huddle Room': '2-4 persone',
                'Meeting Room': '6-12 persone', 
                'Board Room': '8-16 persone',
                'Auditorium': '50+ persone',
                'Training Room': '15-30 persone',
                'Media Room': '2-6 persone',
                'Control Room': '2-8 persone',
                'Ufficio Ibrido': '1-4 persone'
            };
            return counts[spaceType] || '4-8 persone';
        }

        function getTechForSpace(spaceType, techRequirements) {
            const baseTech = ['Display', 'Audio', 'Controllo'];
            const spaceTech = {
                'Huddle Room': ['Webcam', 'Speakerphone'],
                'Meeting Room': ['PTZ Camera', 'Microfoni ceiling'],
                'Board Room': ['Video wall', 'Wireless presentation'],
                'Auditorium': ['Impianto audio PA', 'Recording'],
                'Training Room': ['Proiettore', 'Lavagna interattiva'],
                'Media Room': ['Broadcasting', 'Streaming'],
                'Control Room': ['Multi-monitor', 'KVM'],
                'Ufficio Ibrido': ['BYOD hub', 'Personal devices']
            };
            
            const selected = techRequirements.length > 0 ? techRequirements.slice(0, 2) : spaceTech[spaceType] || baseTech;
            return selected.join(', ');
        }

        // Copy brief to clipboard
        function copyBrief() {
            if (!generatedBriefContent) return;
            
            const textArea = document.createElement("textarea");
            textArea.value = generatedBriefContent.trim();
            textArea.style.position = "fixed";
            textArea.style.top = "-9999px";
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                // Change button text temporarily
                const copyBtn = event.target.closest('button');
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = `
                    <svg class="w-4 h-4 mr-1.5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Copiato!
                `;
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                }, 2000);
            } catch (err) {
                alert('Impossibile copiare il testo.');
            }
            
            document.body.removeChild(textArea);
        }

        // Reset form
        function resetForm() {
            // Reset all form fields
            document.getElementById('clientName').value = '';
            document.getElementById('contactPerson').value = '';
            document.getElementById('meetingDate').value = '';
            document.getElementById('numberOfRooms').value = '';
            document.getElementById('budget').value = '';
            document.getElementById('meetingNotes').value = '';
            document.getElementById('timeline').value = '';
            document.getElementById('specialRequirements').value = '';
            
            // Reset checkboxes
            document.querySelectorAll('#spaceTypes input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('#techRequirements input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            // Reset file uploads
            uploadedFiles = [];
            updateFileDisplay();
            
            // Reset transcript
            transcriptContent = '';
            document.getElementById('transcriptFile').classList.add('hidden');
            document.getElementById('transcriptPreview').classList.add('hidden');
            document.getElementById('transcriptUpload').value = '';
            
            // Show form, hide brief
            document.getElementById('postMeetingForm').classList.remove('hidden');
            document.getElementById('generatedBrief').classList.add('hidden');
            
            generatedBriefContent = '';
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üéâ App Demo inizializzata!");
            // Set default view
            showIntro();
        });
    </script>
</body>
</html> mb-2">Analizza Meeting & Genera Brief DSA</h3>
                            <p class="text-gray-600 mb-4">Analizza appunti del meeting, estrai requisiti e genera brief strutturato per il team DSA con upload di planimetrie e foto.</p>
                            <button onclick="showPostMeeting()" class="w-full inline-flex items-center justify-center px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg">
                                Inizia
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>

                        <!-- Module 2 -->
                        <div class="border border-gray-200 rounded-lg p-6 hover:shadow-md hover:border-blue-300 transition-all">
                            <svg class="w-10 h-10 text-cyan-600 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">Wizard Spazi Collaborativi</h3>
                            <p class="text-gray-600 mb-4">Definisci la soluzione tecnologica ottimale per spazi collaborativi basandoti su misure, tipologia e caratteristiche.</p>
                            <button onclick="showSpaceWizard()" class="w-full inline-flex items-center justify-center px-6 py-2.5 bg-cyan-600 hover:bg-cyan-700 text-white font-medium rounded-lg">
                                Inizia
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Post Meeting Module -->
        <div id="postMeetingSection" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <button onclick="showIntro()" class="inline-flex items-center mb-6 px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300">
                    <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Torna alla Homepage
                </button>
                
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Analizza Meeting & Genera Brief DSA</h2>
                <p class="text-gray-600 mb-8">Trasforma i tuoi appunti del meeting in un brief tecnico strutturato per il team DSA</p>
                
                <!-- Demo/Offline Notice -->
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-8">
                    <h3 class="text-lg font-semibold text-yellow-800 mb-3">üéØ Modalit√† Demo</h3>
                    <p class="text-yellow-700 mb-3">
                        Per evitare problemi di API e costi, questa versione genera un <strong>brief di esempio pre-strutturato</strong> 
                        basato sui dati che inserisci.
                    </p>
                    <p class="text-sm text-yellow-600">
                        üí° Il brief includer√† automaticamente tutti i dati del form e le trascrizioni caricate!
                    </p>
                </div>
                
                <div id="postMeetingForm" class="space-y-8">
                    <!-- Dati Base Cliente -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome Cliente *</label>
                            <input type="text" id="clientName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Es. JBT Corporation">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Contatto Principale</label>
                            <input type="text" id="contactPerson" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Es. Mario Rossi - IT Manager">
                        </div>
                    </div>

                    <!-- Dettagli Meeting -->
                    <div class="grid md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data Meeting</label>
                            <input type="date" id="meetingDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Numero Sale/Spazi *</label>
                            <input type="text" id="numberOfRooms" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Es. 3 meeting room + 1 auditorium">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Budget Indicativo</label>
                            <input type="text" id="budget" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Es. 50k-100k‚Ç¨">
                        </div>
                    </div>

                    <!-- Tipologie Spazi -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Tipologie di Spazi</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="spaceTypes">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Meeting Room" class="mr-3 text-blue-600">
                                <span class="text-sm">Meeting Room</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Huddle Room" class="mr-3 text-blue-600">
                                <span class="text-sm">Huddle Room</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Board Room" class="mr-3 text-blue-600">
                                <span class="text-sm">Board Room</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Auditorium" class="mr-3 text-blue-600">
                                <span class="text-sm">Auditorium</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Training Room" class="mr-3 text-blue-600">
                                <span class="text-sm">Training Room</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Ufficio Ibrido" class="mr-3 text-blue-600">
                                <span class="text-sm">Ufficio Ibrido</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Media Room" class="mr-3 text-blue-600">
                                <span class="text-sm">Media Room</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Control Room" class="mr-3 text-blue-600">
                                <span class="text-sm">Control Room</span>
                            </label>
                        </div>
                    </div>

                    <!-- Requisiti Tecnologici -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Requisiti Tecnologici</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="techRequirements">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="BYOD" class="mr-3 text-blue-600">
                                <span class="text-sm">BYOD</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Microsoft Teams Rooms (MTR)" class="mr-3 text-blue-600">
                                <span class="text-sm">Microsoft Teams Rooms (MTR)</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Videoconferenza" class="mr-3 text-blue-600">
                                <span class="text-sm">Videoconferenza</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Audio Professionale" class="mr-3 text-blue-600">
                                <span class="text-sm">Audio Professionale</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Digital Signage" class="mr-3 text-blue-600">
                                <span class="text-sm">Digital Signage</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Controllo Centralizzato" class="mr-3 text-blue-600">
                                <span class="text-sm">Controllo Centralizzato</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Streaming/Recording" class="mr-3 text-blue-600">
                                <span class="text-sm">Streaming/Recording</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" value="Telepresence" class="mr-3 text-blue-600">
                                <span class="text-sm">Telepresence</span>
                            </label>
                        </div>
                    </div>

                    <!-- Note Meeting con Upload Trascrizione -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Note e Appunti del Meeting *</label>
                        <div class="space-y-4">
                            <textarea id="meetingNotes" rows="8" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Incolla qui tutti gli appunti del meeting, requisiti emersi, problematiche discusse, aspettative del cliente..."></textarea>
                            
                            <!-- Upload Trascrizione Teams -->
                            <div class="border-t pt-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Oppure carica trascrizione Teams/call</label>
                                <div onclick="document.getElementById('transcriptUpload').click()" class="flex items-center justify-center w-full h-20 border-2 border-blue-300 border-dashed rounded-lg bg-blue-50 hover:bg-blue-100 cursor-pointer transition-colors">
                                    <svg class="w-6 h-6 text-blue-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>
                                    </svg>
                                    <span class="text-sm text-blue-700">Carica trascrizione Teams (.txt, .docx, .pdf)</span>
                                </div>
                                <input type="file" id="transcriptUpload" class="hidden" accept=".txt,.docx,.pdf,.doc">
                                <div id="transcriptFile" class="mt-2 hidden">
                                    <div class="flex items-center justify-between bg-blue-100 p-3 rounded-lg">
                                        <div class="flex items-center">
                                            <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                            </svg>
                                            <span id="transcriptFileName" class="font-medium text-blue-800"></span>
                                        </div>
                                        <button onclick="removeTranscript()" class="text-red-500 hover:text-red-700">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div id="transcriptPreview" class="mt-2 hidden">
                                    <div class="bg-gray-50 p-3 rounded-lg max-h-40 overflow-y-auto">
                                        <p class="text-xs text-gray-600 mb-2">Anteprima trascrizione estratta:</p>
                                        <div id="transcriptPreviewContent" class="text-sm text-gray-800"></div>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">Il contenuto del file verr√† automaticamente aggiunto alle note del meeting per l'analisi</p>
                            </div>
                        </div>
                    </div>

                    <!-- Timeline e Requisiti Speciali -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Timeline Progetto</label>
                            <input type="text" id="timeline" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Es. Implementazione entro Q2 2024">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Requisiti Speciali</label>
                            <input type="text" id="specialRequirements" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Es. Certificazioni, integrazione con sistemi esistenti...">
                        </div>
                    </div>

                    <!-- Upload File -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Planimetrie, Foto e Documenti</label>
                        <div onclick="document.getElementById('fileUpload').click()" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg bg-gray-50 hover:bg-gray-100 cursor-pointer transition-colors">
                            <svg class="w-10 h-10 text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <span class="text-sm text-gray-600">Trascina qui o clicca per caricare</span>
                            <span class="text-xs text-gray-500 mt-1">DWG, PDF, immagini, documenti</span>
                        </div>
                        <input type="file" multiple id="fileUpload" class="hidden" accept=".dwg,.pdf,.jpg,.jpeg,.png,.gif,.doc,.docx,.txt,.zip,.rar">
                        <div id="uploadedFiles" class="mt-4 space-y-2 hidden">
                            <p class="font-semibold text-sm">File caricati:</p>
                            <div id="fileList"></div>
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <div class="text-center">
                        <button onclick="generateBrief()" id="generateBtn" class="inline-flex items-center px-8 py-3 bg-blue-600 text-white font-medium text-lg rounded-lg hover:bg-blue-700 shadow-lg">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                            Genera Brief per DSA
                        </button>
                    </div>
                </div>

                <!-- Generated Brief Display -->
                <div id="generatedBrief" class="hidden space-y-6">
                    <div class="flex justify-between items-center">
                        <h3 class="text-2xl font-bold text-gray-800">Brief Generato per il Team DSA</h3>
                        <div class="flex items-center gap-3">
                            <button onclick="copyBrief()" class="inline-flex items-center px-3 py-1.5 bg-gray-200 text-gray-700 text-xs font-medium rounded-lg hover:bg-gray-300">
                                <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                                Copia Brief
                            </button>
                            <button onclick="resetForm()" class="inline-flex items-center px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                Nuova Analisi
                            </button>
                        </div>
                    </div>
                    
                    <div id="briefContent" class="prose prose-lg max-w-none bg-gray-50 p-6 rounded-lg border">
                        <!-- Generated content will be inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Space Wizard Module -->
        <div id="spaceWizardSection" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <button onclick="showIntro()" class="inline-flex items-center mb-6 px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300">
                    <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Torna alla Homepage
                </button>
                
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Wizard Spazi Collaborativi</h2>
                <p class="text-gray-600 mb-8">Definisci la soluzione tecnologica ottimale per il tuo spazio</p>
                
                <div class="text-center py-12">
                    <svg class="w-16 h-16 text-cyan-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                    </svg>
                    <h3 class="text-xl font-semibold text-gray-800
